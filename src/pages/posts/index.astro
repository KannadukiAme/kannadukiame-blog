---
import Layout from '@layouts/Layout.astro'
import PostItem from '@components/PostItem.astro'
import { getCollection } from 'astro:content'
import { format } from 'date-fns'
import siteConfig from '@utils/config'

const blogEntries = await getCollection(
  'blog',
  (blog) => import.meta.env.DEV || !blog.data.draft
)

const allBlogData = blogEntries
  .map((item) => {
    return {
      ...item.data,
      slug: item.slug,
    }
  })
  .sort((a, b) => {
    return b.pubDate.getTime() - a.pubDate.getTime()
  })
const numOfPosts = allBlogData.length
---

<Layout title={`BLOG | ${siteConfig.title}`}>
  <div class="flex w-full dark:text-gray-50">
    <div class="container mx-auto mt-8 mb-[80px]">
      <div class="mb-2">{`共 ${numOfPosts} 篇文章`}</div>
      <div class="grid grid-cols-3 grid-rows-2 gap-5">
        {
          allBlogData.map(({ title, pubDate, heroImage, tags, slug }) => (
            <PostItem
              title={title}
              pubDate={format(pubDate, 'MMM dd, yyyy')}
              heroImage={heroImage}
              tags={tags}
              slug={slug}
            />
          ))
        }
      </div>
    </div>
  </div>
</Layout>
